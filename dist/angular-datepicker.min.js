"use strict";!function(a){var b=a.module("datePicker",[]);b.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),b.filter("mFormat",function(){return function(a,b,c){return moment.isMoment(a)?c?moment.tz(a,c).format(b):moment(a).format(b):"No date"}}),b.directive("datePicker",["datePickerConfig","datePickerUtils",function(a,b){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(c,d,e,f){function g(a){return q?moment.tz(a,q):moment(a)}function h(a){a&&(c.model=a,f&&f.$setViewValue(a)),c.$emit("setDate",c.model,c.view),c.callbackOnSetDate&&c.callbackOnSetDate()}function i(){var a=c.view;c.model&&!p&&(c.date=g(c.model),p=!1);var d=c.date;switch(a){case"year":c.years=b.getVisibleYears(d);break;case"month":c.months=b.getVisibleMonths(d);break;case"date":c.weekdays=c.weekdays||b.getDaysOfWeek(),c.weeks=b.getVisibleWeeks(d);break;case"hours":c.hours=b.getVisibleHours(d);break;case"minutes":c.minutes=b.getVisibleMinutes(d,r)}k()}function j(){return"date"!==c.view?c.view:c.date?c.date.month():null}function k(){var a,d,e=c.view,f=c.date,g=[],h="";if("date"===e){var i,j=c.weeks;for(a=0;a<j.length;a++)for(i=j[a],g.push([]),d=0;d<i.length;d++)h="",b.isSameDay(f,i[d])&&(h+="active"),o(i[d],e)&&(h+=" now"),i[d].month()===f.month()&&l(i[d])||(h+=" disabled"),g[a].push(h)}else{var k={year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]}[e],m=c[k[0]];for(a=0;a<m.length;a++)h="",b[k[1]](f,m[a])&&(h+="active"),o(m[a],e)&&(h+=" now"),l(m[a])||(h+=" disabled"),g.push(h)}c.classes=g}function l(a){var b=!0;return t&&t.isAfter(a)&&(b=m(t,a)),u&&u.isBefore(a)&&(b&=m(u,a)),b}function m(a,b){return a.isSame(b,x[c.view])?!0:!1}function n(a){return t&&t.isAfter(a)?t:u&&u.isBefore(a)?u:a}function o(a,b){var c=!0;switch(b){case"minutes":c&=~~(v.minutes()/r)===~~(a.minutes()/r);case"hours":c&=v.hours()===a.hours();case"date":c&=v.date()===a.date();case"month":c&=v.month()===a.month();case"year":c&=v.year()===a.year()}return c}var p=!1,q=c.tz=e.timezone,r=parseInt(e.step||a.step,10),s=!!e.partial,t=e.minDate?g(e.minDate):!1,u=e.maxDate?g(e.maxDate):!1,v=c.now=g(),w=c.date=g(c.model||v);c.model||w.minute(Math.ceil(w.minute()/r)*r).second(0),c.views=a.views.concat(),c.view=e.view||a.view,c.template=e.template||a.template,b.setParams(q),c.watchDirectChanges=void 0!==e.watchDirectChanges,c.callbackOnSetDate=e.onSetDate?_.get(c.$parent,e.onSetDate):void 0,c.views=c.views.slice(c.views.indexOf(e.maxView||"year"),c.views.indexOf(e.minView||"minutes")+1),(1===c.views.length||-1===c.views.indexOf(c.view))&&(c.view=c.views[0]),c.setView=function(a){-1!==c.views.indexOf(a)&&(c.view=a)},c.selectDate=function(a){if(e.disabled)return!1;if(m(c.date,a)&&(a=c.date),a=n(a),!a)return!1;c.date=a;var b=c.views[c.views.indexOf(c.view)+1];(!b||s||c.model)&&h(a),b?c.setView(b):"true"===e.autoClose?(d.addClass("hidden"),c.$emit("hidePicker")):k()},c.$watch(j,i),c.watchDirectChanges&&c.$watch("model",function(){p=!1,i()}),c.next=function(a){var b=moment(c.date);switch(a=a||1,c.view){case"year":case"month":b.year(b.year()+a);break;case"date":b.month(b.month()+a);break;case"hours":case"minutes":b.hours(b.hours()+a)}b=n(b),b&&(c.date=b,h(b),p=!0,i())};var x={year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"};c.prev=function(a){return c.next(-a||-1)}}}}]),a.module("datePicker").factory("datePickerUtils",function(){var a,b=function(b,c,d,e,f){var g=Date.UTC(0|b,0|c,0|d,0|e,0|f);return a?moment.tz(g,a):moment(g)};return{getVisibleMinutes:function(a,c){var d,e,f=a.year(),g=a.month(),h=a.date(),i=a.hours(),j=a.utcOffset()/60,k=[];for(e=0;60>e;e+=c)d=b(f,g,h,i-j,e),k.push(d);return k},getVisibleWeeks:function(a){a=moment(a);var b=a.year(),c=a.month();a.date(1);var d=a.day();0===d?a.date(-5):a.date(a.date()-d),1===a.date()&&a.date(-6);for(var e=[];e.length<6&&!(a.year()===b&&a.month()>c);)e.push(this.getDaysOfWeek(a)),a.add(7,"d");return e},getVisibleYears:function(a){var c=moment(a),d=c.year();c.year(d-d%10),d=c.year();for(var e,f,g=c.utcOffset()/60,h=[],i=0;12>i;i++)e=b(d,0,1,0-g),f=e.utcOffset()/60,f!==g&&(e=b(d,0,1,0-f),g=f),h.push(e),d++;return h},getDaysOfWeek:function(c){c=c?c:a?moment.tz(a).day(0):moment().day(0);for(var d,e,f=c.year(),g=c.month(),h=c.date(),i=[],j=c.utcOffset()/60,k=0;7>k;k++)d=b(f,g,h,0-j,0,!1),e=d.utcOffset()/60,e!==j&&(d=b(f,g,h,0-e,0,!1)),i.push(d),h++;return i},getVisibleMonths:function(a){for(var c,d,e=a.year(),f=a.utcOffset()/60,g=[],h=0;12>h;h++)c=b(e,h,1,0-f,0,!1),d=c.utcOffset()/60,d!==f&&(c=b(e,h,1,0-d,0,!1)),g.push(c);return g},getVisibleHours:function(a){var c,d,e,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60;for(c=0;24>c;c++)d=b(f,g,h,c-j,0,!1),e=d.utcOffset()/60,e!==j&&(d=b(f,g,h,c-e,0,!1)),i.push(d);return i},isAfter:function(a,b){return a&&a.unix()>=b.unix()},isBefore:function(a,b){return a.unix()<=b.unix()},isSameYear:function(a,b){return a&&a.year()===b.year()},isSameMonth:function(a,b){return this.isSameYear(a,b)&&a.month()===b.month()},isSameDay:function(a,b){return this.isSameMonth(a,b)&&a.date()===b.date()},isSameHour:function(a,b){return this.isSameDay(a,b)&&a.hours()===b.hours()},isSameMinutes:function(a,b){return this.isSameHour(a,b)&&a.minutes()===b.minutes()},setParams:function(b){a=b}}});var b=a.module("datePicker");b.directive("dateRange",function(){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"="},link:function(a,b,c){a.start=new Date(a.start||new Date),a.end=new Date(a.end||new Date),c.$observe("disabled",function(b){a.disableDatePickers=!!b}),a.$watch("start.getTime()",function(b){b&&a.end&&b>a.end.getTime()&&(a.end=new Date(b))}),a.$watch("end.getTime()",function(b){b&&a.start&&b<a.start.getTime()&&(a.start=new Date(b))})}}});var c="ng-pristine",d="ng-dirty",b=a.module("datePicker");b.constant("dateTimeConfig",{template:function(a){return'<div date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.maxDate?'max-date="'+a.maxDate+'" ':"")+(a.autoClose?'auto-close="'+a.autoClose+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.minDate?'min-date="'+a.minDate+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+(a.step?'step="'+a.step+'" ':"")+(a.onSetDate?'on-set-date="'+a.onSetDate+'" ':"")+(a.ngModel?'ng-model="'+a.ngModel+'" ':"")+(a.timezone?'timezone="'+a.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),b.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),b.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse",function(b,e,f,g,h){var i=e.find("body"),j=f("mFormat");return{require:"ngModel",scope:!0,link:function(e,f,k,l){function m(a){return j(a,v,G)}function n(a){return a.length===v.length?a:void 0}function o(b,c){var d=b;do if(d=d.$parent,a.isFunction(d[c]))return d[c];while(d.$parent);return!1}function p(a,b){var c=a;do if(c=c.$parent,c[b])return c[b];while(c.$parent);return!1}function q(){u=g.template(k)}function r(a){a.stopPropagation(),l.$pristine&&(l.$dirty=!0,l.$pristine=!1,f.removeClass(c).addClass(d),w&&w.$setDirty(),l.$render())}function s(){B&&(B.remove(),B=null),D&&(D.remove(),D=null)}function t(){if(!B){if(B=b(u)(e),e.$digest(),I||(e.$on("setDate",function(a,b,c){r(a),H&&H(k.ngModel,b),A&&x[x.length-1]===c&&s()}),e.$on("hidePicker",function(){f.triggerHandler("blur")}),e.$on("$destroy",s),I=!0),"absolute"===C){var c=a.extend(f.offset(),{height:f[0].offsetHeight});B.css({top:c.top+c.height,left:c.left,display:"block",position:C}),i.append(B)}else D=a.element("<div date-picker-wrapper></div>"),f[0].parentElement.insertBefore(D[0],f[0]),D.append(B),B.css({top:f[0].offsetHeight+"px",display:"block"});B.bind("mousedown",function(a){a.preventDefault()})}}var u,v=k.format||g.format,w=f.inheritedData("$formController"),x=h(k.views)(e)||g.views.concat(),y=k.view||x[0],z=x.indexOf(y),A=k.autoClose?h(k.autoClose)(e):g.autoClose,B=null,C=k.position||g.position,D=null,E=null,F=null,G=k.timezone||!1,H=null,I=!1;-1===z&&x.splice(z,1),x.unshift(y),l.$formatters.push(m),l.$parsers.unshift(n),a.isDefined(k.minDate)&&(E=p(e,k.minDate),k.minDate=E?E.format():E),a.isDefined(k.maxDate)&&(F=p(e,k.maxDate),k.maxDate=F?F.format():F),a.isDefined(k.dateChange)&&(H=o(e,k.dateChange)),e.$on("pickerUpdate",function(b,c,d){(a.isArray(c)&&c.indexOf(k.ngModel)>-1||k.ngModel===c)&&(B||(a.isDefined(d.minDate)&&(k.minDate=d.minDate?d.minDate.format():!1),a.isDefined(d.maxDate)&&(k.maxDate=d.maxDate?d.maxDate.format():!1),k.minView=d.minView||k.minView,k.maxView=d.maxView||k.maxView,k.view=d.view||k.view,a.isDefined(d.format)&&(v=k.format=d.format,l.$modelValue=-1),q()))}),f.bind("focus",t),f.bind("blur",s),q()}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\r\n        <td ng-repeat="day in week">\r\n          <span\r\n            ng-class="classes[$index2][$index]"\r\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="classes[$index]"\r\n                ng-repeat="year in years"\r\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(month)"\r\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(minute)"\r\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n"'),a.put("templates/daterange.html",'<div>\r\n    <table>\r\n        <tr>\r\n            <td valign="top">\r\n                <div date-picker="start" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\r\n            </td>\r\n            <td valign="top">\r\n                <div date-picker="end" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n')}])}(angular);